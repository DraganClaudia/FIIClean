<!DOCTYPE html>
<html lang="ro">
<head>
    <script src="js/header.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FII-Clean - Dashboard</title>
    <link rel="stylesheet" href="css/main.css">
</head>
<body>
    <main>
        <section id="quick-stats">
            <h2>📊 Statistici Generale</h2>
            <div id="overall-stats" class="stats-grid">
                <div class="stat-item">
                    <h4>Locații Active</h4>
                    <p class="stat-number" id="total-locations">-</p>
                </div>
                <div class="stat-item">
                    <h4>Comenzi Totale</h4>
                    <p class="stat-number" id="total-orders">-</p>
                </div>
                <div class="stat-item">
                    <h4>Resurse Gestionate</h4>
                    <p class="stat-number" id="total-resources">-</p>
                </div>
                <div class="stat-item">
                    <h4>Venit Total</h4>
                    <p class="stat-number" id="total-revenue">-</p>
                </div>
            </div>
        </section>
        
        <section id="alerts-summary">
            <h2>🚨 Alerte și Notificări</h2>
            <div id="alerts-dashboard">
                <p>Se încarcă alertele...</p>
            </div>
        </section>
        
        <section id="recent-activity">
            <h2>📋 Activitate Recentă</h2>
            <div id="activity-feed">
                <p>Se încarcă activitatea...</p>
            </div>
        </section>
        
        <section id="export-tools">
            <h2>📥 Instrumente Export</h2>
            <div class="export-grid">
                <div class="export-option">
                    <h4>Export Locații</h4>
                    <button onclick="ExportAPI.exportData('locations', 'json')">JSON</button>
                    <button onclick="ExportAPI.exportData('locations', 'csv')">CSV</button>
                </div>
                <div class="export-option">
                    <h4>Export Comenzi</h4>
                    <button onclick="ExportAPI.exportData('orders', 'json')">JSON</button>
                    <button onclick="ExportAPI.exportData('orders', 'csv')">CSV</button>
                </div>
                <div class="export-option">
                    <h4>Export Resurse</h4>
                    <button onclick="ExportAPI.exportData('resources', 'json')">JSON</button>
                    <button onclick="ExportAPI.exportData('resources', 'csv')">CSV</button>
                </div>
                <div class="export-option">
                    <h4>Export Complet</h4>
                    <button onclick="ExportAPI.exportData('all', 'json')">JSON Complet</button>
                </div>
            </div>
        </section>
        
        <section id="rss-feeds">
            <h2>📡 Feed-uri RSS</h2>
            <div class="rss-links">
                <a href="../api/index.php?resource=rss&type=status" target="_blank">📍 Status Locații RSS</a>
                <a href="../api/index.php?resource=rss&type=orders" target="_blank">📋 Comenzi RSS</a>
                <a href="../api/index.php?resource=rss&type=alerts" target="_blank">🚨 Alerte RSS</a>
            </div>
        </section>
        
        <section id="system-info">
            <h2>ℹ️ Informații Sistem</h2>
            <div id="system-stats">
                <p><strong>Ultima actualizare:</strong> <span id="last-update">-</span></p>
                <p><strong>Versiune:</strong> 1.0.0</p>
                <p><strong>Status sistem:</strong> <span class="status-ok">🟢 Operațional</span></p>
            </div>
        </section>
    </main>
    
    <script src="js/api.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        loadDashboardData();
        setInterval(loadDashboardData, 10 * 60 * 1000); 
    });

    async function loadDashboardData() {
        try {
            await Promise.all([
                loadOverallStatistics(),
                loadAlertsAndNotifications(),
                loadRecentActivity()
            ]);
            updateLastUpdateTime();
        } catch (error) {
            console.error('Error loading dashboard:', error);
        }
    }

    async function loadOverallStatistics() {
        try {
            const [locations, orderStats] = await Promise.all([
                LocationsAPI.getAll(),
                OrdersAPI.getStatistics()
            ]);
            
            document.getElementById('total-locations').textContent = locations.length;
            document.getElementById('total-orders').textContent = orderStats.total_orders || 0;
            document.getElementById('total-resources').textContent = 0; // Placeholder
            document.getElementById('total-revenue').textContent = 
                orderStats.total_revenue ? parseFloat(orderStats.total_revenue).toFixed(2) + ' RON' : '0 RON';
        } catch (error) {
            console.error('Error loading statistics:', error);
        }
    }

    async function loadAlertsAndNotifications() {
        try {
            const pendingOrders = await OrdersAPI.getAll();
            const pendingCount = pendingOrders.filter(order => order.status === 'pending').length;
            
            const alertsHtml = pendingCount > 0 ? `
                <div class="alerts-grid">
                    <div class="alert-card pending-orders">
                        <h4>📋 Comenzi în Așteptare</h4>
                        <p>${pendingCount} comenzi așteaptă procesare</p>
                        <button onclick="window.location.href='orders.html'">Vezi Comenzi</button>
                    </div>
                </div>
            ` : `
                <div class="alerts-grid">
                    <div class="alert-card all-good">
                        <h4>✅ Totul în Regulă</h4>
                        <p>Nu există alerte active în sistem</p>
                    </div>
                </div>
            `;
            
            document.getElementById('alerts-dashboard').innerHTML = alertsHtml;
        } catch (error) {
            document.getElementById('alerts-dashboard').innerHTML = '<p>Eroare la încărcarea alertelor.</p>';
        }
    }

    async function loadRecentActivity() {
        try {
            const orders = await OrdersAPI.getAll();
            const recentOrders = orders.slice(0, 5);
            
            const activityHtml = recentOrders.map(order => `
                <div class="activity-item">
                    <div class="activity-icon">📋</div>
                    <div class="activity-content">
                        <h4>Comanda #${order.id}</h4>
                        <p>Client: ${order.client_name} | Serviciu: ${order.service_type}</p>
                        <p>Status: <span class="status-${order.status}">${StatusHelpers.getStatusLabel(order.status)}</span></p>
                        <small>${new Date(order.created_at).toLocaleString('ro-RO')}</small>
                    </div>
                </div>
            `).join('');
            
            document.getElementById('activity-feed').innerHTML = 
                activityHtml || '<p>Nu există activitate recentă.</p>';
        } catch (error) {
            document.getElementById('activity-feed').innerHTML = '<p>Eroare la încărcarea activității.</p>';
        }
    }

    function updateLastUpdateTime() {
        document.getElementById('last-update').textContent = new Date().toLocaleString('ro-RO');
    }
    </script>
</body>
</html>
